# 贪吃蛇移植项目综述
## 程序实现
- 源程序使用了C语言，初期运行时使用`ANSI`的转义字符来实现画面渲染的功能，比如通过修改文字前景色来画像素
- 贪吃蛇比较好实现，基本一个上午花个把小时就可以解决，基本逻辑是在每一帧的渲染中逐步运行非阻塞字符获取，动作响应与渲染，最后判断状态，是否死亡、退出等
- 菜单的实现也比较简单，之前曾自己写过一个菜单框架，可以实现无限制多级的菜单层级预设置

## 平台
- esp8266
- 0.96寸四针OLED屏幕
- 4*4矩阵按键

## 移植程序简述
### 思路
1. 适配平台使用的文字库，图形库，最后选择了u8g2库和keypad库，再加上自己写的实现贪吃蛇和多级菜单的库
2. 主体大框架是多级菜单的框架，各种功能通过菜单的选择来实现

### 实现困难
- win11貌似对CH340的支持不是很好，频繁出现各种烧录错误BUG
- 由于我最初使用Arduino来编写程序，缺少方便的语法检测和格式对齐，耽误了很多时间，后期转用vscode，Arduino的插件也是不尽人意
- Arduino程序编译错误给出的信息比较模糊，遇到过一下几个比较难Debug的程序
  1. 程序超出设备允许性能，会有seg相关的报错
  2. 使用非法变量进行u8g2绘制图像时，编译运行不会报错，但串口会丢出异常堆栈
  3. for循环`int i = 0;`因操作失误删去` = 0`， Arduino编译器不会给出warning，而是正常编译，然后出错，特别是一些需要使用有关`i`的变量进行绘图的场景，容易触发第二条BUG
  4. Arduino工程进行分文件编写时，会出现变量重复定义的情况，即使使用了`#ifndef`语句来规避，Arduino依旧无法正常编译
- 因为分文件编写很糟心，代码主体主要使用了`#include`来实现代码分布编写，只是作为一个直接的代码替换

### 项目总结
- 使用的库太多了，单片机性能跟不上，要注意精简代码
- 4*4键盘占用太多`pin`，后期可以改用电位摇杆，精简`pin`的同时增加可操控性